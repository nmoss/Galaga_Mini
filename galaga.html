<!DOCTYPE html>
<html>
	<head>
	<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
	<title>Galaga</title>
	<script type="text/javascript" src="background.js"></script>
	<script type="text/javascript" src="galaga_sprite.js"></script>
	
	<style type="text/css">
		canvas { border: 1px solid black; }

		#field {
				 display: block;
				 margin-left: auto;
				 margin-right: auto; }	
		
		#title { text-align: center;
				 color: green; }

		p { text-align: center; }
	</style>
	<script type="text/javascript">
		
		var fighter = new Image();
		fighter.src = "fighter.png";
		fighter.x = 0;
		fighter.y = 0;
		var x = 0;

		var missile = new Image();
		missile.src = "missile.png";
		var missile_x = x;
		var missile_y = 240; //maybe
		var fired = false;

		var galagans = [];


		var enemy_missile = new Image();
		enemy_missile.src = "enemy_missile.png";
		var enem_missile_x = 0;
		var enem_missile_y = 0;
		var enem_fired = false;


	



		var isHit = false;
		var dead = false;


		function init(){
			var field = document.getElementById("field");
			var ctx = field.getContext("2d");

			var image = "background.png";

			ctx.drawImage(fighter, 0, 250, 14*2, 14*2);
			//ctx.drawImage(galagan_blue, 45, 132, 8, 10);

			var parallax = new ParallaxScrolling(ctx, image, fighter);

			function onKeyDown(event){
				if(event.keyCode == 37){
					if(x > -4){
						x = x - 3;
					} else {
						x = 0;
					}
				}
				if(event.keyCode == 39){
					if( x < 220){
						x = x + 3;
					} else {
						x = 214;
					}
				}
				if(event.keyCode == 32){
					//console.log("I'm a firing my lazer");
					if(fired == false){
						fired = true;
						missile_x = x+4;
					}
				}
			}

			//runs the game
			function run(){
				ctx.clearRect(0, 0, field.width, field.height);
				parallax.draw();
				draw_fighter();
				if(fired){
					if(missile_hit_detect_galagan()){
						//do explosion stuff
						isHit = true;
						fired = false;


					} else {
						draw_missile();
					}
				}
				if(isHit){
					for(var i = 0; i < 4; i++){
						galagan_explosion.draw(ctx);
					}
					isHit = false;
					dead = true;
					//isHit = false;
				} else if(dead == false) {
					galagan.draw(ctx);
				}
				galagan_fire();
				if(enem_fired){
					if(ship_hit()){
						ship_explosion.x = x;

						for(var i = 0; i < 4; i++){
							ship_explosion.draw(ctx);
						}
						enem_fired = false;
						enem_missile_y = 0;
						x = -50;
						clearInterval(game);
					}
					else {
						draw_enemy_missile();
					}
				}
				//draw_galagans();

			}

			function draw_fighter(){
				ctx.drawImage(fighter, x, 250, 14*2, 14*2);
			}

			function draw_missile(){
				ctx.drawImage(missile, missile_x, missile_y, 10, 12);
				missile_y -= 10;
				if(missile_y < 30){
					fired = false;
					missile_y = 240;
				}
			}

			function draw_enemy_missile(){
				ctx.drawImage(enemy_missile, enem_missile_x, enem_missile_y, 10, 12);
				enem_missile_y += 10;
				if(enem_missile_y > 400){
					enem_fired = false;
					enem_missile_y = 0;
				}
			}

			//need to take a list of all the galagans
			function galagan_fire(){
				if(enem_fired == false){
					enem_missile_y = 105;
					enem_missile_x = 140;
					enem_fired = true;
				} else {
					return false;
				}
			}

			function draw_galagans(){
				ctx.drawImage(galagan_blue, 140, 100, 10*2, 14*2);
			}

			//need a list of all the galagans to enter here...
			function missile_hit_detect_galagan(){
				if(missile_x >= 135 && missile_x <=155 && missile_y <= 100){
					fired = false;
					missile_y = 240;
					return true;
				}
				return false;
			}

			//need to put enemy missile here
			function ship_hit(){
				if(enem_missile_x >= x && enem_missile_x <= x + 10 && enem_missile_y >= 250){
					enem_fired = false;
					enem_missile_y = 240; //something else 
					return true;
				}
				return false;
			}
			


			//** ANIMATED STUFF **//
			var galagan_data = {
				field: field,
				imgSrc: "galagan_blue_animated.png",
				x: 140,
				y: 100,
				spw: 20,
				frames: 2
			};

			var galagan_explosion_data = {
				field: field,
				imgSrc: "galagan_explosion.png",
				x: 140,
				y: 100,
				spw: 24,
				frames: 5
			};

			var ship_explosion_data = {
				field: field,
				imgSrc: "ship_explosion.png",
				x: 0,
				y: 250,
				spw: 26,
				frames: 4
			};

			var galagan = new GalagaSprite(galagan_data);
			galagans[0] = galagan;
 			var galagan_explosion = new GalagaSprite(galagan_explosion_data);
			var ship_explosion = new GalagaSprite(ship_explosion_data);

			var handler = window.addEventListener('keydown', onKeyDown, true);
			var game = window.setInterval(run, 60);
		} //init()

	</script>
	</head>
	<body onload="init()">
		<canvas id="field" width="244px" height="288px"></canvas>

	</body>	
</html>